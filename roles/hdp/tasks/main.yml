- name: install HDP REPO
  yum_repository:
    name: HDP
    description: HDP {{ hdp.version}}
    baseurl: "{{ hdp.url }}"
    gpgcheck: no
  environment:  "{{ global.proxyenv }}"
  become: true


- name: install HDP
  yum:
    name: "{{item }}"
  environment:  "{{ global.proxyenv }}"
  become: true
  with_items:
    - zookeeper
    - hadoop-hdfs
    - hadoop-yarn

# Using blueprint API  https://community.hortonworks.com/articles/47170/automate-hdp-installation-using-ambari-blueprints.html
- name: create cluster 
  uri:
    headers:
      X-Requested-By: ambari
    url: http://localhost:8080/api/v1/blueprints/{{ hdp.clusterid }}
    method: POST
    user: admin
    password: admin
    body: "{{ lookup('file','cluster_configuration.json') }}"
    force_basic_auth: yes
    status_code: 201
    body_format: json
